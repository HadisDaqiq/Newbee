{% extends 'base.html' %}

{%block head%}
<title> Homepage</title>
{%endblock head%} 

{%block content%}

<h2>Events</h2>

<button class="" id = "start-event-btn"> 
    Start a event
</button>

{% for event in events %}
<div>
    <img class="card-img-top" style="width: 287px;" src={{image_urls[event.sport_id]}} alt="Card image cap">


    <a href='/event_detail?eventId={{event.event_id}}'>

        <div class="card" style="width: 18rem;">
            <div class="card-body">
               <h5 class="event-title"> {{event.title}}</h5>
           </a>
           <p class="event-des"> Detail: {{event.description}}</p>
       </div>
       <ul class="list-group list-group-flush">
        <li class="list-group-item">Location: {{event.location}}</li>
        <li class="list-group-item">Date: {{event.date}} Time: {{event.time}} </li>
        </ul>
    <div class="card-body" id="{{event.event_id}}">
        <a href="event-detail" class="join">Join </a>
        <a href="/"class="delete">Delete</a>
    </div>
</div>

{%endfor%}



<div id = "save-event-popup" style = "display: none">
    <div class = "popup-content">

        <form action= "/event" id = "prevent-form-submission-form" 
        method= "GET">
        Sport
        <select name ="sport">
            {%for sport in sports%}
            <option value ="{{sport.sport_id}}">{{sport.sport_name}}</option>
            {%endfor%}
        </select>

        <br>
        Title
        <input type= "text" name= "title"/>
        <br>
        Description
        <input type= "text" name="des"/>
        <br>
        Location
        <input type= "text" name="location"/>

        <br>
        Date 
        <input type= "text" name="start_date"/>
        Time
        <input type = "text" name="end_date"/>


        <input type="submit" value="Create" />

    </form>
</div>
</div>

<script>

    //prevents the default autmatic exit at the pop up form of creating event.
    let stalledForm = document.querySelector("#prevent-form-submission-form");

    stalledForm.addEventListener("click", function (evt) {
    //it is stoping the event form to look for a click handler outside of its container
    evt.stopPropagation();
    
});

    //after clicking on starting event button and making the pop up form appear.
    $("#start-event-btn").on('click', ()=>{
        console.log("it is working!")
        $("#save-event-popup").show()
    })

    //exit out of popup once it clicks exit or outside of the form.(Gray area)
    $("#save-event-popup").on('click', ()=>{
        console.log("Submit btn hit")
        $("#save-event-popup").hide()
    })

    $(".delete").on('click', (event)=>{
        var currentEventId = event.target.parentNode.id;
        console.log(currentEventId)
        // ajax gets a key value par. data cant take just a variable.
        $.ajax({
            url: '/delete_event',  
            data: {currentEventId: currentEventId},
            success: function(result){
                alert(" delete event id went to the server");
            }
        });
        console.log("action button thing for delete is working")
    })

</script>

{%endblock content%}   

